<!DOCTYPE html>
<html>

<head>
  <title>BPRAXIS HS18 Heatmap</title>
  <link rel="stylesheet" type="text/css" href="dist/calendar-heatmap.min.css">
</head>

<body>
  <h1><font face="verdana" color="black">Has the BPRAXIS Module HS18 been evaluated yet?</font></h1>
  <br>
  <div id="calendar"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.10.2/d3.min.js" charset="utf-8"></script>
  <script src="dist/calendar-heatmap.min.js"></script>

  <script>
  function readFile(file) {
    var reader = new FileReader();
    reader.onload = function (evt) {
      var textContents = evt.target.result;
      console.log(textContents);
    };
    reader.readAsText(file);
  }

    function csvJSON() {
      //disclaimer, i'm a js noob, just to let you know
     //read file
     //Get CSV
      var blob = null;
      var xhr = new XMLHttpRequest();
      xhr.open("GET", "https://daveschafer.github.io/BPRAXIS_Heatmap/bpraxis_data.csv");
      xhr.responseType = "blob";//force the HTTP response, response-type header to be blob
      xhr.onload = function () {
        blob = xhr.response;//xhr.response is now a blob object
      }
      xhr.send();
     //Read String
     var myReader = new FileReader();
      myReader.addEventListener("loadend", function (e) {
        var str = e.srcElement.result;
      });
      myReader.readAsText(blob);
    
      var result = [];

      var headers = lines[0].split(",");
      console.info(headers)
      for (var i = 1; i < lines.length; i++) {

        var obj = {};
        var currentline = lines[i].split(",");

        for (var j = 0; j < headers.length; j++) {
          obj[headers[j]] = currentline[j];
        }

        result.push(obj);

      }
   

      //return result; //JavaScript object
      console.info("result:");
      console.info(result)
      return JSON.stringify(result); //JSON
    
    }
  </script>

  <script>
    (function () {
      // Initialize random data for the demo
      var now = moment().endOf('day').toDate();
      var time_ago = moment().startOf('day').subtract(10, 'year').toDate();

      var sourceJSON = csvJSON()
      console.info("Hello There");
      console.info(csvJSON());
      
      var m_data = [{
          "date": sourceJSON.date,
          "total": sourceJSON.total,
          "details": [{
            "name": sourceJSON.name,
            "value": sourceJSON.value
          }]
        }]
      
      /*[{
          "date": "2019-01-01",
          "total": 900,
          "details": [{
            "name": "Published? NO!",
            "value": 0
          }]
        },{ 
          "date": "2019-01-02",
          "name": "test",
          "total": 200,
          "details": [{
            "name": "Published? NO!",
            "value": 0
          }]
        },{ 
          "date": "2019-01-04",
          "total": 250,
          "details": [{
            "name": "FS19 now online...",
            "value": 0
          }]
        }, {
          "date": "2019-02-06",
          "total": 200,
          "details": [{
            "name": "Published? NO!",
            "value": 0
          }]
        }      
      ]*/

      // Set the div target id
      var div_id = 'calendar';

      // Set custom color for the calendar heatmap
     // var color = '#cd2327';
     var color = '#4894c4';

      // Set overview type (choices are year, month and day)
      var overview = 'year';

      // Handler function
      var print = function (val) {
        console.log(val);
      };

      // Initialize calendar heatmap
      calendarHeatmap.init(m_data, div_id, color, overview, print);
      calendarHeatmap.init()
    })();
  </script>
</body>

</html>